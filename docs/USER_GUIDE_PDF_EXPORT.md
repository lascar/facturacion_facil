# ğŸ“„ GUÃA DE USUARIO - ExportaciÃ³n de Facturas a PDF

## ğŸ¯ **Â¿QuÃ© es la ExportaciÃ³n a PDF?**

La funcionalidad de exportaciÃ³n a PDF te permite generar documentos PDF profesionales de tus facturas para:
- **Enviar por email** a clientes
- **Imprimir** copias fÃ­sicas
- **Archivar** documentos digitalmente
- **Cumplir** con requisitos legales

---

## ğŸ“‹ **Pasos para Exportar una Factura a PDF**

### **1. Abrir la Ventana de Facturas**
- Desde el menÃº principal, hacer clic en **"Facturas"**
- Se abrirÃ¡ la ventana con la lista de facturas y el formulario

### **2. Seleccionar una Factura**
- En la **lista de la izquierda**, buscar la factura que deseas exportar
- **Hacer clic** en la fila de la factura
- La factura se cargarÃ¡ automÃ¡ticamente en el formulario de la derecha

### **3. Verificar la SelecciÃ³n**
- El **tÃ­tulo del formulario** cambiarÃ¡ a: `"Editando Factura: [NÃšMERO]"`
- Los **datos de la factura** aparecerÃ¡n en el formulario
- La **lista de productos** se mostrarÃ¡ en la parte inferior

### **4. Exportar a PDF**
- Hacer clic en el botÃ³n **"Exportar PDF"**
- El sistema generarÃ¡ el PDF automÃ¡ticamente
- El archivo se abrirÃ¡ en tu visor de PDF predeterminado

---

## ğŸ” **VerificaciÃ³n Visual**

### **Factura Correctamente Seleccionada:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Editando Factura: FACT-1758878404-2025             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚ NÃºmero: FACT-1758878404-2025                           â”‚
â”‚ Cliente: Juan PÃ©rez                                     â”‚
â”‚ Fecha: 27/09/2024                                       â”‚
â”‚ Total: â‚¬125.50                                          â”‚
â”‚                                                         â”‚
â”‚ Productos:                                              â”‚
â”‚ â€¢ Producto A - Cantidad: 2 - â‚¬50.00                   â”‚
â”‚ â€¢ Producto B - Cantidad: 1 - â‚¬25.50                   â”‚
â”‚                                                         â”‚
â”‚              [Exportar PDF]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Factura NO Seleccionada:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ Datos de la Factura                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚ NÃºmero: [vacÃ­o]                                         â”‚
â”‚ Cliente: [vacÃ­o]                                        â”‚
â”‚ Fecha: [vacÃ­o]                                          â”‚
â”‚ Total: [vacÃ­o]                                          â”‚
â”‚                                                         â”‚
â”‚ Productos: [lista vacÃ­a]                                â”‚
â”‚                                                         â”‚
â”‚              [Exportar PDF]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš ï¸ **Mensajes de Error y Soluciones**

### **Error: "Seleccione una factura para exportar"**

#### **Causa:**
No hay ninguna factura seleccionada en la lista.

#### **SoluciÃ³n:**
1. **Ir a la lista de facturas** (lado izquierdo)
2. **Hacer clic en una fila** de la lista
3. **Verificar** que el tÃ­tulo cambie a "Editando Factura: [NÃšMERO]"
4. **Intentar exportar** nuevamente

#### **Si el problema persiste:**
- **Reiniciar la aplicaciÃ³n**
- **Verificar** que la factura existe en la base de datos
- **Revisar logs** en `logs/facturacion_facil.log`

### **Error: "ReportLab no estÃ¡ instalado"**

#### **Causa:**
La biblioteca necesaria para generar PDFs no estÃ¡ instalada.

#### **SoluciÃ³n:**
```bash
pip install reportlab
```

### **Error: "No se puede escribir el archivo PDF"**

#### **Causa:**
Problemas de permisos en el directorio de salida.

#### **SoluciÃ³n:**
- **Verificar permisos** del directorio donde se guarda el PDF
- **Ejecutar como administrador** si es necesario
- **Cambiar directorio** de salida en configuraciÃ³n

### **Error: "Datos de factura incompletos"**

#### **Causa:**
La factura seleccionada no tiene todos los datos necesarios.

#### **SoluciÃ³n:**
1. **Editar la factura** para completar datos faltantes
2. **Guardar los cambios**
3. **Intentar exportar** nuevamente

---

## ğŸ“Š **Contenido del PDF Generado**

### **InformaciÃ³n de la Empresa:**
- Nombre de la empresa
- DirecciÃ³n
- TelÃ©fono y email
- NÃºmero de identificaciÃ³n fiscal

### **InformaciÃ³n del Cliente:**
- Nombre completo
- DNI/NIE
- DirecciÃ³n
- Email y telÃ©fono

### **Detalles de la Factura:**
- NÃºmero de factura
- Fecha de emisiÃ³n
- Modo de pago
- Fecha de vencimiento (si aplica)

### **Productos/Servicios:**
- DescripciÃ³n detallada
- Cantidad
- Precio unitario
- IVA aplicado
- Subtotal por lÃ­nea

### **Totales:**
- Subtotal sin IVA
- Total IVA
- **Total factura**

### **InformaciÃ³n Legal:**
- Condiciones de pago
- InformaciÃ³n fiscal requerida
- Notas adicionales

---

## ğŸ”§ **SoluciÃ³n de Problemas Avanzados**

### **Problema: La factura no se selecciona**

#### **DiagnÃ³stico:**
1. **Abrir logs** en `logs/facturacion_facil.log`
2. **Buscar lÃ­neas** que contengan "ğŸ” DEBUG"
3. **Verificar** si aparecen estos mensajes:

```
ğŸ” DEBUG: Buscando factura con nÃºmero: FACT-XXXXX
ğŸ” DEBUG: Factura encontrada: True
ğŸ” DEBUG: Factura ID: XX, Items: X
```

#### **Si NO aparecen estos logs:**
- **Problema:** El evento de selecciÃ³n no se estÃ¡ ejecutando
- **SoluciÃ³n:** Reiniciar la aplicaciÃ³n, verificar que se hace clic en la fila correcta

#### **Si aparece "Factura encontrada: False":**
- **Problema:** La factura no existe en la base de datos
- **SoluciÃ³n:** Verificar que la factura no fue eliminada, recrear si es necesario

### **Problema: PDF se genera pero estÃ¡ vacÃ­o**

#### **DiagnÃ³stico:**
1. **Verificar** que la factura tiene productos asociados
2. **Revisar** que los totales no son cero
3. **Comprobar** que los datos del cliente estÃ¡n completos

#### **SoluciÃ³n:**
1. **Editar la factura** para agregar productos si faltan
2. **Completar datos** del cliente
3. **Recalcular totales** guardando la factura
4. **Intentar exportar** nuevamente

### **Problema: PDF se abre pero no se ve bien**

#### **Posibles causas:**
- **Fuentes** no disponibles en el sistema
- **Caracteres especiales** no soportados
- **TamaÃ±o de pÃ¡gina** incorrecto

#### **SoluciÃ³n:**
- **Actualizar ReportLab**: `pip install --upgrade reportlab`
- **Verificar configuraciÃ³n** de fuentes en el sistema
- **Reportar** el problema con captura de pantalla

---

## ğŸ“š **Consejos y Mejores PrÃ¡cticas**

### **Para Mejores Resultados:**
- âœ… **Completar todos los datos** del cliente antes de exportar
- âœ… **Verificar totales** antes de generar el PDF
- âœ… **Usar descripciones claras** en los productos
- âœ… **Revisar el PDF** antes de enviarlo al cliente

### **Para OrganizaciÃ³n:**
- ğŸ“ **Crear carpetas** por mes o cliente para organizar PDFs
- ğŸ“ **Usar nombres descriptivos** para los archivos
- ğŸ’¾ **Hacer copias de seguridad** de los PDFs importantes
- ğŸ“§ **Enviar por email** directamente desde la aplicaciÃ³n (si disponible)

### **Para Cumplimiento Legal:**
- ğŸ“‹ **Verificar** que todos los datos fiscales estÃ¡n completos
- ğŸ”¢ **Asegurar** que la numeraciÃ³n de facturas es consecutiva
- ğŸ“… **Mantener** las fechas correctas
- ğŸ’¼ **Archivar** los PDFs segÃºn requisitos legales locales

---

## ğŸ†˜ **Soporte TÃ©cnico**

### **Si Necesitas Ayuda:**

#### **InformaciÃ³n a Proporcionar:**
1. **NÃºmero de factura** que intentas exportar
2. **Mensaje de error** exacto que aparece
3. **Captura de pantalla** de la ventana de facturas
4. **Logs relevantes** de `logs/facturacion_facil.log`

#### **Logs Importantes a Buscar:**
```bash
# Ver logs de selecciÃ³n
grep "ğŸ” DEBUG" logs/facturacion_facil.log

# Ver errores de PDF
grep "PDF" logs/facturacion_facil.log

# Ver errores generales
grep "ERROR" logs/facturacion_facil.log
```

#### **Tests de DiagnÃ³stico:**
```bash
# Test de selecciÃ³n de facturas
python3 test/demo/demo_test_factura_selection.py

# Test de exportaciÃ³n PDF
python3 test/demo/demo_test_pdf_export.py
```

---

## ğŸ“ **Contacto**

Para soporte tÃ©cnico adicional:
- **Revisar documentaciÃ³n** en `docs/fixes/PDF_EXPORT_SELECTION_FIX.md`
- **Ejecutar tests** de diagnÃ³stico
- **Proporcionar logs** detallados del problema

---

**Ãšltima ActualizaciÃ³n**: 27 de septiembre de 2024  
**VersiÃ³n**: Con correcciÃ³n de selecciÃ³n de facturas  
**Estado**: âœ… **FUNCIONANDO CORRECTAMENTE**
