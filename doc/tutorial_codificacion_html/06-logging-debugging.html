<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logging & Debugging - Tutorial Codificaci√≥n Avanzada</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üêõ</text></svg>">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêõ Logging & Debugging</h1>
            <p>Sistema Avanzado de Logs Rotativos y Debugging Profesional</p>
        </div>

        <div class="nav">
            <a href="index.html">üè† Inicio</a>
            <a href="01-arquitectura-codigo.html">üèóÔ∏è Arquitectura</a>
            <a href="02-configuracion-sistema.html">‚öôÔ∏è Configuraci√≥n</a>
            <a href="03-base-datos-avanzada.html">üóÑÔ∏è Base de Datos</a>
            <a href="04-customtkinter-avanzado.html">üé® CustomTkinter</a>
            <a href="05-sistema-ventanas.html">ü™ü Sistema Ventanas</a>
            <a href="06-logging-debugging.html" class="active">üêõ Logging & Debug</a>
            <a href="07-testing-avanzado.html">üß™ Testing</a>
            <a href="08-patrones-diseno.html">üîß Patrones</a>
            <a href="09-optimizacion-performance.html">‚ö° Performance</a>
        </div>

        <div class="alert alert-info">
            <h4>üéØ Filosof√≠a de Logging Profesional</h4>
            <p>Facturaci√≥n F√°cil implementa un <strong>sistema de logging de nivel empresarial</strong> con rotaci√≥n autom√°tica, separaci√≥n por niveles, logging espec√≠fico por m√≥dulos y herramientas avanzadas de debugging. El sistema est√° dise√±ado para facilitar el mantenimiento y la resoluci√≥n de problemas en producci√≥n.</p>
        </div>

        <div class="card">
            <div class="card-header">
                üèóÔ∏è Arquitectura del Sistema de Logging
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col">
                        <h3>üìä Estructura de Logs</h3>
                        <pre><code>logs/
‚îú‚îÄ‚îÄ facturacion_facil.log          # Log principal
‚îú‚îÄ‚îÄ facturacion_facil.log.1        # Backup 1 (5MB)
‚îú‚îÄ‚îÄ facturacion_facil.log.2        # Backup 2
‚îú‚îÄ‚îÄ facturacion_facil.log.3        # Backup 3
‚îú‚îÄ‚îÄ facturacion_facil.log.4        # Backup 4
‚îú‚îÄ‚îÄ facturacion_facil.log.5        # Backup 5
‚îú‚îÄ‚îÄ facturacion_facil_errors.log   # Solo errores
‚îú‚îÄ‚îÄ facturacion_facil_errors.log.1 # Error backup 1
‚îú‚îÄ‚îÄ facturacion_facil_errors.log.2 # Error backup 2
‚îú‚îÄ‚îÄ facturacion_facil_errors.log.3 # Error backup 3
‚îî‚îÄ‚îÄ session_20241201_143022.log    # Log de sesi√≥n</code></pre>
                    </div>
                    <div class="col">
                        <h3>üìã Niveles de Logging</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Nivel</th>
                                    <th>Uso</th>
                                    <th>Destino</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>DEBUG</strong></td>
                                    <td>Informaci√≥n detallada</td>
                                    <td>Solo archivo</td>
                                </tr>
                                <tr>
                                    <td><strong>INFO</strong></td>
                                    <td>Informaci√≥n general</td>
                                    <td>Archivo + Consola</td>
                                </tr>
                                <tr>
                                    <td><strong>WARNING</strong></td>
                                    <td>Advertencias</td>
                                    <td>Archivo + Consola</td>
                                </tr>
                                <tr>
                                    <td><strong>ERROR</strong></td>
                                    <td>Errores</td>
                                    <td>Archivo + Errors + Consola</td>
                                </tr>
                                <tr>
                                    <td><strong>CRITICAL</strong></td>
                                    <td>Errores cr√≠ticos</td>
                                    <td>Todos los destinos</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                üîß AppLogger: Clase Principal de Logging
            </div>
            <div class="card-body">
                <h3>üèóÔ∏è Implementaci√≥n del Sistema de Logging</h3>
                <p>La clase <code>AppLogger</code> implementa un sistema completo con rotaci√≥n autom√°tica y m√∫ltiples handlers:</p>
                
                <pre><code># utils/logger.py - Sistema de Logging Profesional
class AppLogger:
    """Clase para manejar el logging de la aplicaci√≥n con caracter√≠sticas empresariales"""
    
    def __init__(self, app_name="facturacion_facil"):
        self.app_name = app_name
        self.log_dir = "logs"
        self.setup_logging()
    
    def setup_logging(self):
        """Configura el sistema de logging con m√∫ltiples handlers"""
        # Crear directorio de logs si no existe
        os.makedirs(self.log_dir, exist_ok=True)
        
        # Configurar el logger principal
        self.logger = logging.getLogger(self.app_name)
        self.logger.setLevel(logging.DEBUG)
        
        # Evitar duplicar handlers si ya existen
        if self.logger.handlers:
            return
        
        # Formato detallado para archivos
        file_formatter = logging.Formatter(
            '%(asctime)s - %(name)s - %(levelname)s - %(filename)s:%(lineno)d - %(message)s',
            datefmt='%Y-%m-%d %H:%M:%S'
        )
        
        # Formato simplificado para consola
        console_formatter = logging.Formatter(
            '%(asctime)s - %(levelname)s - %(message)s',
            datefmt='%H:%M:%S'
        )
        
        # 1. Handler para archivo principal (rotativo)
        main_log_file = os.path.join(self.log_dir, f"{self.app_name}.log")
        file_handler = RotatingFileHandler(
            main_log_file,
            maxBytes=5*1024*1024,  # 5MB por archivo
            backupCount=5,         # Mantener 5 backups
            encoding='utf-8'
        )
        file_handler.setLevel(logging.DEBUG)
        file_handler.setFormatter(file_formatter)
        
        # 2. Handler para errores (archivo separado)
        error_log_file = os.path.join(self.log_dir, f"{self.app_name}_errors.log")
        error_handler = RotatingFileHandler(
            error_log_file,
            maxBytes=2*1024*1024,  # 2MB para errores
            backupCount=3,         # 3 backups para errores
            encoding='utf-8'
        )
        error_handler.setLevel(logging.ERROR)
        error_handler.setFormatter(file_formatter)
        
        # 3. Handler para consola (solo INFO y superior)
        console_handler = logging.StreamHandler(sys.stdout)
        console_handler.setLevel(logging.INFO)
        console_handler.setFormatter(console_formatter)
        
        # A√±adir todos los handlers
        self.logger.addHandler(file_handler)
        self.logger.addHandler(error_handler)
        self.logger.addHandler(console_handler)
        
        # Log de inicio del sistema
        self.logger.info(f"=== Iniciando {self.app_name} ===")
        self.logger.info(f"Directorio de logs: {os.path.abspath(self.log_dir)}")
    
    def get_logger(self, module_name=None):
        """Obtiene un logger espec√≠fico para un m√≥dulo"""
        if module_name:
            # Logger jer√°rquico: facturacion_facil.module_name
            return logging.getLogger(f"{self.app_name}.{module_name}")
        return self.logger</code></pre>

                <div class="row">
                    <div class="col">
                        <h3>üéØ Caracter√≠sticas Avanzadas</h3>
                        <ul>
                            <li><strong>Rotaci√≥n Autom√°tica:</strong> Archivos de 5MB con 5 backups</li>
                            <li><strong>Separaci√≥n de Errores:</strong> Archivo dedicado para errores</li>
                            <li><strong>Encoding UTF-8:</strong> Soporte completo para caracteres especiales</li>
                            <li><strong>M√∫ltiples Destinos:</strong> Archivo, errores y consola</li>
                            <li><strong>Formato Detallado:</strong> Timestamp, m√≥dulo, l√≠nea de c√≥digo</li>
                        </ul>
                    </div>
                    <div class="col">
                        <h3>üìä Configuraci√≥n de Handlers</h3>
                        <ul>
                            <li><strong>File Handler:</strong> DEBUG+ ‚Üí archivo principal</li>
                            <li><strong>Error Handler:</strong> ERROR+ ‚Üí archivo de errores</li>
                            <li><strong>Console Handler:</strong> INFO+ ‚Üí salida est√°ndar</li>
                            <li><strong>Session Handler:</strong> DEBUG+ ‚Üí archivo de sesi√≥n</li>
                            <li><strong>Module Loggers:</strong> Loggers espec√≠ficos por m√≥dulo</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                üéØ Logging Especializado por Dominio
            </div>
            <div class="card-body">
                <h3>üìã Funciones de Logging Espec√≠ficas</h3>
                <p>El sistema incluye funciones especializadas para diferentes tipos de operaciones:</p>
                
                <pre><code># utils/logger.py - Funciones Especializadas
class AppLogger:
    
    def log_user_action(self, action, details=""):
        """Log una acci√≥n del usuario con contexto"""
        self.logger.info(f"üë§ Acci√≥n usuario: {action} - {details}")
    
    def log_database_operation(self, operation, table="", details=""):
        """Log una operaci√≥n de base de datos"""
        self.logger.debug(f"üóÑÔ∏è DB {operation} en {table}: {details}")
    
    def log_file_operation(self, operation, file_path="", details=""):
        """Log una operaci√≥n de archivo"""
        self.logger.debug(f"üìÅ Archivo {operation}: {file_path} - {details}")
    
    def log_exception(self, exception, context=""):
        """Log una excepci√≥n con stack trace completo"""
        self.logger.error(f"üí• Excepci√≥n en {context}: {str(exception)}", exc_info=True)
    
    def log_startup_info(self):
        """Log informaci√≥n del sistema al inicio"""
        self.logger.info(f"üêç Python version: {sys.version}")
        self.logger.info(f"üìÇ Directorio de trabajo: {os.getcwd()}")
        self.logger.info(f"‚öôÔ∏è Argumentos: {sys.argv}")
    
    def create_session_log(self):
        """Crea un log espec√≠fico para la sesi√≥n actual"""
        session_time = datetime.now().strftime("%Y%m%d_%H%M%S")
        session_log_file = os.path.join(self.log_dir, f"session_{session_time}.log")
        
        # Handler espec√≠fico para la sesi√≥n
        session_handler = logging.FileHandler(session_log_file, encoding='utf-8')
        session_handler.setLevel(logging.DEBUG)
        
        formatter = logging.Formatter(
            '%(asctime)s - %(levelname)s - %(filename)s:%(lineno)d - %(message)s',
            datefmt='%Y-%m-%d %H:%M:%S'
        )
        session_handler.setFormatter(formatter)
        
        # Logger espec√≠fico para la sesi√≥n
        session_logger = logging.getLogger(f"{self.app_name}.session")
        session_logger.addHandler(session_handler)
        session_logger.setLevel(logging.DEBUG)
        
        session_logger.info(f"üöÄ Nueva sesi√≥n iniciada: {session_time}")
        return session_logger

# Funciones de conveniencia globales
def log_user_action(action, details=""):
    """Log una acci√≥n del usuario"""
    app_logger.log_user_action(action, details)

def log_database_operation(operation, table="", details=""):
    """Log una operaci√≥n de base de datos"""
    app_logger.log_database_operation(operation, table, details)

def log_file_operation(operation, file_path="", details=""):
    """Log una operaci√≥n de archivo"""
    app_logger.log_file_operation(operation, file_path, details)

def log_exception(exception, context=""):
    """Log una excepci√≥n con contexto"""
    app_logger.log_exception(exception, context)</code></pre>

                <div class="row">
                    <div class="col">
                        <h3>üéØ Ejemplos de Uso</h3>
                        <pre><code># En ui/productos.py
from utils.logger import log_user_action, log_file_operation

def guardar_producto(self):
    log_user_action("Guardar producto", f"Ref: {self.referencia}")
    
    if self.imagen_path:
        log_file_operation("COPY", self.imagen_path, "assets/images/")
    
    # ... l√≥gica de guardado ...

# En database/database.py
from utils.logger import log_database_operation

def execute_query(self, query, params=None):
    log_database_operation("EXECUTE", "", query[:50] + "...")
    # ... ejecuci√≥n de query ...</code></pre>
                    </div>
                    <div class="col">
                        <h3>üìä Tipos de Logging</h3>
                        <ul>
                            <li><strong>üë§ User Actions:</strong> Clicks, formularios, navegaci√≥n</li>
                            <li><strong>üóÑÔ∏è Database Ops:</strong> Queries, transacciones, errores DB</li>
                            <li><strong>üìÅ File Ops:</strong> Lectura, escritura, copia de archivos</li>
                            <li><strong>üí• Exceptions:</strong> Errores con stack trace completo</li>
                            <li><strong>üöÄ System Info:</strong> Informaci√≥n de inicio y configuraci√≥n</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                üîç Herramientas de Debugging Avanzado
            </div>
            <div class="card-body">
                <h3>üõ†Ô∏è T√©cnicas de Debugging Implementadas</h3>
                <p>El sistema incluye herramientas avanzadas para debugging y an√°lisis de problemas:</p>
                
                <pre><code># test/debug/debug_stock_search.py - Debugging Espec√≠fico
def debug_stock_search():
    """Funci√≥n de debugging para problemas espec√≠ficos"""
    print("üîß Debug - B√∫squeda Stock")
    print("=" * 40)
    
    # 1. Test de simulaci√≥n de datos
    def test_stock_search_simulation():
        """Simula el comportamiento de b√∫squeda sin UI"""
        try:
            # Datos de prueba
            stock_data = [
                {'producto_nombre': 'Laptop Dell', 'referencia': 'DELL001'},
                {'producto_nombre': 'Mouse Logitech', 'referencia': 'LOG001'},
                {'producto_nombre': 'Teclado Mec√°nico', 'referencia': 'TEC001'}
            ]
            
            # Simular b√∫squeda
            search_term = "dell"
            filtered_data = [
                item for item in stock_data 
                if search_term.lower() in item['producto_nombre'].lower() or
                   search_term.lower() in item['referencia'].lower()
            ]
            
            assert len(filtered_data) == 1, f"Esperado 1, obtenido {len(filtered_data)}"
            assert filtered_data[0]['referencia'] == 'DELL001'
            
            print("‚úÖ Simulaci√≥n de b√∫squeda funciona correctamente")
            return True
            
        except Exception as e:
            print(f"‚ùå Error en simulaci√≥n: {e}")
            import traceback
            traceback.print_exc()
            return False
    
    # 2. Test de eventos tkinter
    def test_real_tkinter_behavior():
        """Test con tkinter real para verificar eventos"""
        try:
            import tkinter as tk
            
            root = tk.Tk()
            root.withdraw()  # Ocultar ventana
            
            # Variables de test
            search_var = tk.StringVar()
            filter_called = []
            
            def mock_filter(*args):
                search_text = search_var.get()
                filter_called.append(search_text)
                print(f"üîç Filtro llamado con: '{search_text}'")
            
            # Bind del evento
            search_var.trace('w', mock_filter)
            
            # Tests
            search_var.set("test")
            root.update()
            
            search_var.set("dell")
            root.update()
            
            search_var.set("")
            root.update()
            
            root.destroy()
            
            print(f"‚úÖ Eventos tkinter: {len(filter_called)} llamadas")
            return True
            
        except Exception as e:
            print(f"‚ùå Error en test tkinter: {e}")
            return False
    
    # Ejecutar tests
    success1 = test_stock_search_simulation()
    success2 = test_real_tkinter_behavior()
    
    if success1 and success2:
        print("\nüéâ DEBUGGING COMPLETO")
        print("‚úÖ L√≥gica de filtrado: Funciona")
        print("‚úÖ Eventos tkinter: Funcionan")
    
    return success1 and success2</code></pre>

                <div class="row">
                    <div class="col">
                        <h3>üîß T√©cnicas de Debugging</h3>
                        <ul>
                            <li><strong>Simulaci√≥n de Datos:</strong> Test sin dependencias UI</li>
                            <li><strong>Mock Objects:</strong> Simulaci√≥n de componentes complejos</li>
                            <li><strong>Event Testing:</strong> Verificaci√≥n de eventos tkinter</li>
                            <li><strong>Isolation Testing:</strong> Test de componentes aislados</li>
                            <li><strong>Stack Trace Analysis:</strong> An√°lisis detallado de errores</li>
                        </ul>
                    </div>
                    <div class="col">
                        <h3>üìä Comandos de Debugging</h3>
                        <pre><code># Ver logs en tiempo real
tail -f logs/facturacion_facil.log

# Ver √∫ltimas 50 l√≠neas
tail -50 logs/facturacion_facil.log

# Ver solo errores
cat logs/facturacion_facil_errors.log

# Buscar en logs
grep "ERROR" logs/facturacion_facil.log

# Ver logs de sesi√≥n espec√≠fica
ls logs/session_*.log | tail -1 | xargs cat</code></pre>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                üìä An√°lisis de Logs y Monitoreo
            </div>
            <div class="card-body">
                <h3>üìà Ejemplo de Logs en Producci√≥n</h3>
                <p>Ejemplo real de logs generados por el sistema:</p>
                
                <pre><code># logs/facturacion_facil.log - Ejemplo Real
2024-12-01 14:30:22 - facturacion_facil - INFO - main.py:15 - === Iniciando facturacion_facil ===
2024-12-01 14:30:22 - facturacion_facil - INFO - logger.py:76 - Directorio de logs: /home/pascal/for_django/facturacion_facil/logs
2024-12-01 14:30:22 - facturacion_facil - INFO - logger.py:86 - üêç Python version: 3.8.10 (default, Nov 14 2022, 12:59:47)
2024-12-01 14:30:22 - facturacion_facil - INFO - logger.py:87 - üìÇ Directorio de trabajo: /home/pascal/for_django/facturacion_facil
2024-12-01 14:30:22 - facturacion_facil - INFO - main.py:20 - Inicializando base de datos...
2024-12-01 14:30:22 - facturacion_facil.database - DEBUG - database.py:45 - üóÑÔ∏è DB EXECUTE en : PRAGMA foreign_keys = ON...
2024-12-01 14:30:22 - facturacion_facil - INFO - main.py:22 - Base de datos inicializada correctamente
2024-12-01 14:30:22 - facturacion_facil - INFO - main.py:25 - Creando ventana principal
2024-12-01 14:30:23 - facturacion_facil - INFO - main.py:28 - Iniciando bucle principal de la aplicaci√≥n
2024-12-01 14:30:45 - facturacion_facil.productos - INFO - productos.py:156 - üë§ Acci√≥n usuario: Abrir gesti√≥n productos - 
2024-12-01 14:30:52 - facturacion_facil.productos - INFO - productos.py:234 - üë§ Acci√≥n usuario: Seleccionar imagen - 
2024-12-01 14:30:52 - facturacion_facil.productos - DEBUG - productos.py:245 - üìÅ Archivo COPY: /home/pascal/Pictures/producto.jpg - Copiado a assets/images/
2024-12-01 14:31:05 - facturacion_facil.productos - INFO - productos.py:189 - üë§ Acci√≥n usuario: Guardar producto - Ref: PROD001
2024-12-01 14:31:05 - facturacion_facil.database - DEBUG - database.py:67 - üóÑÔ∏è DB INSERT en productos: Producto PROD001 guardado</code></pre>

                <div class="alert alert-success">
                    <h4>üéØ Informaci√≥n Capturada en Logs</h4>
                    <ul>
                        <li><strong>Timestamp Preciso:</strong> Fecha y hora exacta de cada evento</li>
                        <li><strong>M√≥dulo y L√≠nea:</strong> Ubicaci√≥n exacta en el c√≥digo</li>
                        <li><strong>Nivel de Severidad:</strong> DEBUG, INFO, WARNING, ERROR, CRITICAL</li>
                        <li><strong>Contexto de Acci√≥n:</strong> Qu√© estaba haciendo el usuario</li>
                        <li><strong>Detalles T√©cnicos:</strong> Par√°metros, archivos, queries SQL</li>
                        <li><strong>Stack Traces:</strong> Informaci√≥n completa de errores</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="navigation-buttons">
            <a href="05-sistema-ventanas.html" class="btn btn-secondary">‚¨ÖÔ∏è Sistema de Ventanas</a>
            <a href="07-testing-avanzado.html" class="btn btn-primary">Siguiente: Testing Avanzado ‚û°Ô∏è</a>
        </div>

        <div class="footer">
            <p>&copy; 2024 Facturaci√≥n F√°cil - Tutorial de Codificaci√≥n Avanzada</p>
        </div>
    </div>

    <script src="enhance_code_blocks.js"></script>
</body>
</html>
